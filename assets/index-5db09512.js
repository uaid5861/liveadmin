import{a9 as k,d as x,V as U,r as w,a as f,o as d,f as m,g as t,e as c,b,i as D,c as $,p as q,F as B,A as I,t as S,aa as E,W as y,Q as H}from"./index-e1b9afb8.js";import{u as T}from"./useHandleData-9b50ca4a.js";function z(o){return k.get("/admin/acl/user/list",o)}function M(o){return k.post("/admin/acl/user/save",o)}function Q(o){return k.put("/admin/acl/user/update",o)}function W(o){return k.delete(`/admin/acl/user/delete/${o}`)}function j(o){return k.delete("/admin/acl/user/batchDelete",o)}function G(o){return k.get(`/admin/acl/user/toAssign/${o}`)}function J(o){return k.post("/admin/acl/user/doAssign",o)}const K=x({name:"UserDrawer"}),O=x({...K,setup(o,{expose:v}){const C=U({username:[{required:!0,message:"请填写用户姓名"},{min:4,message:"用户名不能小于4位"}],password:[{required:!0,message:"请填写用户密码"},{min:6,message:"密码不能小于6位"}]}),_=w(!1),l=w({title:""}),g=w(!1),a=U({allRolesList:[],assignRoles:[],checkAll:!1,isIndeterminate:!1}),R=s=>{a.assignRoles=s?a.allRolesList.map(e=>e.id):[],console.log(a.assignRoles),a.isIndeterminate=!1},r=s=>{const e=s.length;a.checkAll=e===a.allRolesList.length,a.isIndeterminate=e>0&&e<a.allRolesList.length},i=s=>{if(s.title==="分配角色"){const{list:e}=s;a.allRolesList=e.data.allRolesList,a.assignRoles=e.data.assignRoles.map(p=>p.id),a.isIndeterminate=a.assignRoles.length>0}l.value=s,_.value=!0},u=w(),h=()=>{u.value.validate(async s=>{if(s)try{if(g.value=!0,l.value.title==="分配角色"){const e={userId:l.value.rowData.id,roleIdList:a.assignRoles};await l.value.api(e)}else await l.value.api(l.value.rowData);I.success({message:`${l.value.title}用户成功！`}),l.value.getTableList(),_.value=!1,g.value=!1}catch(e){g.value=!1,console.log(e)}})};return v({acceptParams:i}),(s,e)=>{const p=f("el-input"),V=f("el-form-item"),L=f("el-checkbox"),N=f("el-checkbox-group"),P=f("el-form"),A=f("el-button"),F=f("el-drawer");return d(),m(F,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=n=>_.value=n),"destroy-on-close":!0,size:"450px",title:`${l.value.title}用户`},{footer:t(()=>[c(A,{onClick:e[5]||(e[5]=n=>_.value=!1)},{default:t(()=>[b("取消")]),_:1}),c(A,{type:"primary",onClick:h,loading:g.value},{default:t(()=>[b(" 确定 ")]),_:1},8,["loading"])]),default:t(()=>[c(P,{ref_key:"ruleFormRef",ref:u,"label-width":"100px","label-suffix":" :",rules:C,model:l.value.rowData},{default:t(()=>[c(V,{label:"用户姓名",prop:"username"},{default:t(()=>[c(p,{disabled:l.value.title==="分配角色",modelValue:l.value.rowData.username,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.rowData.username=n),placeholder:"请填写用户姓名",clearable:""},null,8,["disabled","modelValue"])]),_:1}),l.value.title!=="分配角色"?(d(),m(V,{key:0,label:"用户昵称",prop:"name"},{default:t(()=>[c(p,{modelValue:l.value.rowData.nickName,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.rowData.nickName=n),placeholder:"请填写用户昵称",clearable:""},null,8,["modelValue"])]),_:1})):D("",!0),l.value.title==="新增"?(d(),m(V,{key:1,label:"用户密码",prop:"password"},{default:t(()=>[c(p,{modelValue:l.value.rowData.password,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.rowData.password=n),placeholder:"请填写用户密码",clearable:""},null,8,["modelValue"])]),_:1})):D("",!0),l.value.title==="分配角色"?(d(),m(V,{key:2,label:"角色列表",prop:"rolesId"},{default:t(()=>[c(L,{modelValue:a.checkAll,"onUpdate:modelValue":e[3]||(e[3]=n=>a.checkAll=n),indeterminate:a.isIndeterminate,style:{"margin-right":"30px"},onChange:R},{default:t(()=>[b(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),c(N,{modelValue:a.assignRoles,"onUpdate:modelValue":e[4]||(e[4]=n=>a.assignRoles=n),onChange:r},{default:t(()=>[(d(!0),$(B,null,q(a.allRolesList,n=>(d(),m(L,{key:n.id,label:n.id},{default:t(()=>[b(S(n.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):D("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),Z=x({__name:"index",setup(o){const v=w(),C=[{type:"selection",fixed:"left",width:80},{type:"index",label:"#",width:80},{prop:"id",label:"id"},{prop:"username",label:"用户名",search:{el:"input",props:{placeholder:"输入用户名"}}},{prop:"nickName",label:"用户昵称"},{prop:"roleName",label:"角色列表"},{prop:"phone",label:"联系方式",width:120},{prop:"createTime",label:"创建时间",sortable:!0,width:120},{prop:"updateTime",label:"更新时间",sortable:!0,width:120},{prop:"operation",label:"操作",fixed:"right",width:280}],_=U({}),l=w(),g=async(r,i={})=>{var h;let u={title:r,rowData:{...i},list:r==="分配角色"?await G(i.id||""):[],api:r==="新增"?M:r==="编辑"?Q:J,getTableList:(h=v.value)==null?void 0:h.getTableList};l.value.acceptParams(u)},a=async r=>{var i;if((r==null?void 0:r.username)==="admin"){I({type:"warning",message:"系统用户不允许删除"});return}await T(W,r.id,`删除${r.username}用户`),(i=v.value)==null||i.getTableList()},R=async r=>{var i,u;await T(j,r,"删除所选用户信息"),(i=v.value)==null||i.clearSelection(),(u=v.value)==null||u.getTableList()};return(r,i)=>{const u=f("el-button"),h=f("ProTable"),s=E("auth");return d(),$("div",null,[c(h,{ref_key:"proTable",ref:v,columns:C,requestApi:H(z),initParam:_},{tableHeader:t(e=>[y((d(),m(u,{type:"primary",icon:"Plus",onClick:i[0]||(i[0]=p=>g("新增"))},{default:t(()=>[b(" 添加 ")]),_:1})),[[s,["btn.User.add"]]]),y((d(),m(u,{type:"danger",icon:"Delete",plain:"",onClick:p=>R(e.selectedListIds),disabled:!e.isSelected},{default:t(()=>[b(" 批量删除 ")]),_:2},1032,["onClick","disabled"])),[[s,["btn.User.remove"]]])]),operation:t(e=>[y((d(),m(u,{type:"primary",link:"",icon:"UserFilled",onClick:p=>g("分配角色",e.row)},{default:t(()=>[b(" 分配角色 ")]),_:2},1032,["onClick"])),[[s,["btn.User.assgin"]]]),y((d(),m(u,{type:"primary",link:"",icon:"Edit",onClick:p=>g("编辑",e.row)},{default:t(()=>[b(" 编辑 ")]),_:2},1032,["onClick"])),[[s,["btn.User.update"]]]),y((d(),m(u,{type:"primary",link:"",icon:"Delete",onClick:p=>a(e.row)},{default:t(()=>[b(" 删除 ")]),_:2},1032,["onClick"])),[[s,"btn.User.remove"]])]),_:1},8,["requestApi","initParam"]),c(O,{ref_key:"drawerRef",ref:l},null,512)])}}});export{Z as default};
