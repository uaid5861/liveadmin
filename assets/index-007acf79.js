import{u as L}from"./useHandleData-9b50ca4a.js";import{d as C,r as d,V as R,a as _,o as k,f as w,g as o,e as s,b as D,Q as r,A as U,c as q,t as A,i as T}from"./index-e1b9afb8.js";import{b as N,c as h,u as S,d as H}from"./permission-aaa67ce0.js";import{u as M}from"./useAuthButtons-9e7fcd42.js";const O=C({name:"RoleDialog"}),Q=C({...O,setup($,{expose:g}){let n=d({name:"",code:""});const y=R({name:[{required:!0,message:"请填写名称"}],code:[{required:!0,message:"请填写权限值"}]}),u=d(!1),v=d(),b=d(!1),t=d({type:1}),m=l=>{const e=l.rowData;l.type===1?n.value={pid:e.id,level:e.level+1,type:e.level==3?2:1}:n.value=e,v.value=c(l),t.value=l,u.value=!0},c=l=>{const e=l.rowData&&l.rowData.level;let a="";return l.type===1?(e===1&&(a="添加一级菜单"),e===2&&(a="添加二级菜单"),e===3&&(a="添加功能")):(e===1&&(a="修改一级菜单"),(e===2||e===3)&&(a="修改二级菜单"),e===4&&(a="修改功能")),a},p=d(),i=l=>{l&&l.validate(async e=>{if(e)try{b.value=!0,await t.value.api(n.value),U.success({message:`${v.value}成功！`}),t.value.getTableList(),u.value=!1,b.value=!1,V(l)}catch(a){b.value=!1,console.log(a)}})},V=l=>{l&&l.resetFields()};return g({acceptParams:m}),(l,e)=>{const a=_("el-input"),P=_("el-form-item"),B=_("el-form"),x=_("el-button"),F=_("el-dialog");return k(),w(F,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=f=>u.value=f),title:v.value,"destroy-on-close":!0,width:"500px"},{footer:o(()=>[s(x,{onClick:e[2]||(e[2]=f=>u.value=!1)},{default:o(()=>[D("取消")]),_:1}),s(x,{type:"primary",onClick:e[3]||(e[3]=f=>i(p.value)),loading:b.value},{default:o(()=>[D(" 确定 ")]),_:1},8,["loading"])]),default:o(()=>[s(B,{ref_key:"ruleFormRef",ref:p,"label-width":"100px","label-suffix":" :",rules:y,model:r(n)},{default:o(()=>[s(P,{label:"名称",prop:"name"},{default:o(()=>[s(a,{modelValue:r(n).name,"onUpdate:modelValue":e[0]||(e[0]=f=>r(n).name=f),placeholder:"请填写名称",clearable:""},null,8,["modelValue"])]),_:1}),s(P,{label:"权限值",prop:"code"},{default:o(()=>[s(a,{modelValue:r(n).code,"onUpdate:modelValue":e[1]||(e[1]=f=>r(n).code=f),placeholder:"请填写权限值",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),I=C({__name:"index",setup($){const{BUTTONS:g}=M(),n=[{prop:"name",label:"名称",align:"left"},{prop:"code",label:"权限值"},{prop:"updateTime",label:"修改时间"},{prop:"operation",label:"操作",fixed:"right",width:280}],y=d(),u=d(),v=(t,m)=>{var p;const c={type:t,rowData:{...m},api:t==1?h:S,getTableList:(p=y.value)==null?void 0:p.getTableList};u.value.acceptParams(c)},b=async(t={})=>{var m;await L(H,t==null?void 0:t.id,`删除${t.name}`),(m=y.value)==null||m.getTableList()};return(t,m)=>{const c=_("el-button"),p=_("ProTable");return k(),q("div",null,[s(p,{ref_key:"proTable",ref:y,pagination:!1,toolButton:!1,columns:n,requestApi:r(N)},{operation:o(i=>[r(g)["btn.Permission.add"]?(k(),w(c,{key:0,type:"primary",link:"",icon:"UserFilled",disabled:i.row.level===4,onClick:V=>v(1,i.row)},{default:o(()=>[D(A(i.row.level===3?"添加功能":"添加菜单"),1)]),_:2},1032,["disabled","onClick"])):T("",!0),r(g)["btn.Permission.update"]?(k(),w(c,{key:1,type:"primary",link:"",icon:"Edit",disabled:i.row.level===1,onClick:V=>v(2,i.row)},{default:o(()=>[D(" 编辑 ")]),_:2},1032,["disabled","onClick"])):T("",!0),r(g)["btn.Permission.remove"]?(k(),w(c,{key:2,type:"primary",link:"",icon:"Delete",disabled:i.row.level===1,onClick:V=>b(i.row)},{default:o(()=>[D(" 删除 ")]),_:2},1032,["disabled","onClick"])):T("",!0)]),_:1},8,["requestApi"]),s(Q,{ref_key:"DialogRef",ref:u},null,512)])}}});export{I as default};
